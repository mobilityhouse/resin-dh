From efd24d57426bd77c9b5860e6b297904703750412 Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Wed, 28 Sep 2016 00:05:12 +0200
Subject: [PATCH] base64: check for integer overflow on large input

CVE: CVE-2016-8617
Upstream-Status: Backport

Bug: https://curl.haxx.se/docs/adv_20161102C.html
Reported-by: Cure53

Signed-off-by: Sona Sarmadi <sona.sarmadi@enea.com>
---
diff -ruN a/lib/base64.c b/lib/base64.c
--- a/lib/base64.c	2016-02-03 00:02:43.000000000 +0100
+++ b/lib/base64.c	2016-11-07 09:22:07.918167530 +0100
@@ -190,6 +190,11 @@
   if(0 == insize)
     insize = strlen(indata);
 
+#if SIZEOF_SIZE_T == 4
+  if(insize > UINT_MAX/4)
+    return CURLE_OUT_OF_MEMORY;
+#endif
+
   base64data = output = malloc(insize*4/3+4);
   if(NULL == output)
     return CURLE_OUT_OF_MEMORY;
